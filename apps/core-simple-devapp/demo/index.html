<!DOCTYPE html>
<html lang="en" cds-base-font="16">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="./favicon.ico" />
    <link href="/node_modules/normalize.css/normalize.css" rel="stylesheet" />
    <link href="/node_modules/@cds/core/global.min.css" rel="stylesheet" />
    <link
      href="/node_modules/@cds/core/styles/theme.dark.min.css"
      rel="stylesheet"
    />
    <link
      href="/node_modules/@cds/city/css/bundles/default.min.css"
      rel="stylesheet"
    />
    <link href="./index.css" rel="stylesheet" />
  </head>
  <body cds-theme="" cds-text="body">
    <!-- cds-theme="dark" to preview in dark theme -->
    <div class="wrapper" cds-layout="grid cols:4 gap:md align:stretch">
      <div cds-layout="p:lg">
        <cds-button
          id="topleft"
          status="primary"
          type="button"
          onclick="showOverlay(this)"
          >Show A</cds-button
        >
      </div>
      <div cds-layout="vertical p:lg align:horizontal-center">
        <cds-button
          id="topcenter"
          status="primary"
          type="button"
          onclick="showOverlay(this)"
          >Show B</cds-button
        >
      </div>
      <div cds-layout="p:lg">
        <div style="width: 100%; text-align: right; height: 36px">
          <cds-button
            id="topright"
            status="primary"
            type="button"
            onclick="showOverlay(this)"
            >Show C</cds-button
          >
        </div>
      </div>
      <div cds-layout="grid p:lg align:center">
        <cds-button
          id="midleft"
          status="primary"
          type="button"
          onclick="showOverlay(this)"
          >Show D</cds-button
        >
      </div>

      <div id="midcenter" cds-layout="p:lg vertical align:center gap:md">
        <h3 cds-text="title" cds-layout="p-b:lg">Configure your popup</h3>
        <form id="popupForm">
          <cds-form-group cds-layout="vertical" layout="compact">
            <cds-select control-width="shrink">
              <label>Cross-axis alignment</label>
              <select onchange="syncAnchorAlignments(this)">
                <option selected value="start">Start</option>
                <option value="mid">Middle</option>
                <option value="end">End</option>
              </select>
            </cds-select>
            <cds-select control-width="shrink">
              <label>Pointer alignment</label>
              <select onchange="syncPointerAlignments(this)">
                <option selected value="start">Start</option>
                <option value="mid">Middle</option>
                <option value="end">End</option>
              </select>
            </cds-select>
            <cds-select control-width="shrink">
              <label>Pointer type</label>
              <select onchange="syncPointerType(this)">
                <option selected value="none">None</option>
                <option value="default">Default</option>
                <option value="angle">Angle</option>
                <option value="custom">Custom 1</option>
                <option value="emoji">Emoji</option>
              </select>
            </cds-select>
            <cds-select control-width="shrink">
              <label>Popup Orientation Prefs</label>
              <select onchange="syncPrefs(this)">
                <option selected value="">Default</option>
                <option value="top left">Top Left</option>
                <option value="left top">Left Top</option>
                <option value="not:top not:bottom">Only Horizontal</option>
                <option value="not:left not:right">Only Vertical</option>
                <option value="only:right">Only Right</option>
              </select>
            </cds-select>
            <cds-checkbox>
              <label>Show overlay</label>
              <input type="checkbox" onclick="toggleOverlay(this)" />
            </cds-checkbox>
            <cds-checkbox>
              <label>Close on backdrop click</label>
              <input type="checkbox" onclick="allowBackdropClick(this)" />
            </cds-checkbox>
            <cds-checkbox>
              <label>Bigger Popup</label>
              <input type="checkbox" onclick="embiggenPopup(this)" />
            </cds-checkbox>
          </cds-form-group>
        </form>
      </div>

      <div cds-layout="grid p:lg align:center cols:12">
        <div style="width: 100%; text-align: right; height: 36px">
          <cds-button
            id="midright"
            status="primary"
            type="button"
            onclick="showOverlay(this)"
            >Show E</cds-button
          >
        </div>
      </div>
      <div cds-layout="grid p:lg align:bottom">
        <cds-button
          id="btmleft"
          status="primary"
          type="button"
          onclick="showOverlay(this)"
          >Show F</cds-button
        >
      </div>
      <div cds-layout="grid p:lg align:bottom cols:12">
        <div style="width: 100%; text-align: center; height: 36px">
          <cds-button
            id="btmcenter"
            status="primary"
            type="button"
            onclick="showOverlay(this)"
            >Show G</cds-button
          >
        </div>
      </div>
      <div cds-layout="grid p:lg align:bottom cols:12">
        <div style="width: 100%; text-align: right; height: 36px">
          <cds-button
            id="btmright"
            status="primary"
            type="button"
            onclick="showOverlay(this)"
            >Show H</cds-button
          >
        </div>
      </div>
    </div>

    <cds-internal-popup hidden id="mypopup">
      <div
        class="popup-content"
        cds-layout="vertical gap:lg p:lg align:stretch"
      >
        <h1 cds-text="section">Popup</h1>
        <p cds-text="body">I am a popup with no pointer, like a dropdown.</p>
        <cds-button
          style="max-height: 36px"
          type="button"
          onclick="closeOverlay('button-click')"
          >Ok</cds-button
        >
      </div>
    </cds-internal-popup>

    <cds-internal-popup hidden id="mypopup-default">
      <div
        class="popup-content"
        cds-layout="vertical gap:lg p:lg align:stretch"
      >
        <h1 cds-text="section">Popup</h1>
        <p cds-text="body">I am a popup with a default pointer.</p>
        <cds-button
          style="max-height: 36px"
          type="button"
          onclick="closeOverlay('button-click')"
          >Ok</cds-button
        >
      </div>
      <cds-internal-pointer></cds-internal-pointer>
    </cds-internal-popup>

    <cds-internal-popup hidden id="mypopup-angle">
      <div
        class="popup-content"
        cds-layout="vertical gap:lg p:lg align:stretch"
      >
        <h1 cds-text="section">Angle Popup</h1>
        <p cds-text="body">My pointer is an angle like signposts have.</p>
        <cds-button
          style="max-height: 36px"
          type="button"
          onclick="closeOverlay('button-click')"
          >Ok</cds-button
        >
      </div>
      <cds-internal-pointer type="angle"></cds-internal-pointer>
    </cds-internal-popup>

    <cds-internal-popup hidden id="mypopup-bubbles">
      <div
        class="popup-content"
        cds-layout="vertical gap:lg p:lg align:stretch"
      >
        <h1 cds-text="section">Bubbles Popup</h1>
        <p cds-text="body">Everyone likes bubbles.</p>
        <cds-button
          style="max-height: 36px"
          type="button"
          onclick="closeOverlay('button-click')"
          >Ok</cds-button
        >
      </div>
      <cds-internal-pointer type="">
        <svg
          width="49px"
          height="57px"
          viewBox="0 0 49 57"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          style="transform: translateY(0.1rem)"
        >
          <path
            d="M36,56.5 C28,56.5 4,56.5 0,56.5 C0,49.0441559 8.0588745,43 18,43 C27.9411255,43 36,49.0441559 36,56.5 Z M34.5,56.5 C26.5,56.5 5.5,56.5 1.5,56.5 C1.5,49.0441559 9,44.2999878 18,44.2999878 C27,44.2999878 34.5,49.0441559 34.5,56.5 Z"
            style="fill: var(--pointer-outline)"
          ></path>
          <path
            style="fill: var(--pointer-fill); transform: translateY(0.05rem)"
            d="M34,56.5 C36,49.0441559 27.9411255,43 18,43 C8.0588745,43 1,49.0441559 1,56.5 C4,56.5 28,56.5 34,56.5 Z"
          ></path>
          <ellipse
            style="fill: var(--pointer-fill)"
            cx="35"
            cy="29.5"
            rx="14"
            ry="11.5"
          ></ellipse>
          <path
            style="fill: var(--pointer-outline)"
            d="M35,41 C27.2680135,41 21,35.8512746 21,29.5 C21,23.1487254 27.2680135,18 35,18 C42.7319865,18 49,23.1487254 49,29.5 C49,35.8512746 42.7319865,41 35,41 Z M35,40 C42.1797017,40 48,35.2989899 48,29.5 C48,23.7010101 42.1797017,19 35,19 C27.8202983,19 22,23.7010101 22,29.5 C22,35.2989899 27.8202983,40 35,40 Z"
          ></path>
          <path
            style="fill: var(--pointer-fill)"
            d="M17.5,17 C22.1294457,17 27,13.1944204 27,8.5 C27,3.80557963 22.1294457,0 17.5,0 C12.8705543,0 8,3.80557963 8,8.5 C8,13.1944204 12.8705543,17 17.5,17 Z"
          ></path>
          <path
            style="fill: var(--pointer-outline)"
            d="M17.5,17 C12.8705543,17 8,13.1944204 8,8.5 C8,3.80557963 12.8705543,0 17.5,0 C22.1294457,0 27,3.80557963 27,8.5 C27,13.1944204 22.1294457,17 17.5,17 Z M17.5,16 C21.6421356,16 26,12.6421356 26,8.5 C26,4.35786438 21.6421356,1 17.5,1 C13.3578644,1 9,4.35786438 9,8.5 C9,12.6421356 13.3578644,16 17.5,16 Z"
          ></path>
        </svg>
      </cds-internal-pointer>
    </cds-internal-popup>

    <cds-internal-popup hidden id="mypopup-emoji">
      <div
        class="popup-content"
        cds-layout="vertical gap:lg p:lg align:stretch"
      >
        <h1 cds-text="section">Emoji Popup</h1>
        <p cds-text="body">I am a popup with a real pointing pointer!</p>
        <cds-button
          style="max-height: 36px"
          type="button"
          onclick="closeOverlay('button-click')"
          >Ok</cds-button
        >
      </div>
      <cds-internal-pointer id="popupPointer" type=""
        ><span style="font-size: 32px; padding-bottom: 2px"
          >👆</span
        ></cds-internal-pointer
      >
    </cds-internal-popup>

    <script type="module" src="./index.js"></script>

    <script type="text/javascript">
      let pointerType = 'none';
      const allPopups = document.querySelectorAll('cds-internal-popup');
      const getPopup = () => {
        switch (pointerType) {
          case 'default':
            return document.getElementById('mypopup-default');
          case 'angle':
            return document.getElementById('mypopup-angle');
          case 'emoji':
            return document.getElementById('mypopup-emoji');
          case 'custom':
            return document.getElementById('mypopup-bubbles');
          case 'none':
          default:
            return document.getElementById('mypopup');
        }
      };

      function showOverlay(anchor) {
        const popup = getPopup();

        console.log(anchor);
        console.log(popup);

        popup.anchor = anchor;
        popup.hidden = false;

        if (!popup.hasAttribute('_initted')) {
          popup.addEventListener('closeChange', e => {
            closeOverlay(e.detail);
          });
          popup.setAttribute('_initted', '');
        }
      }

      function closeOverlay(src) {
        if (
          closeOnBackdropClick ||
          src === 'escape-keypress' ||
          src === 'button-click'
        ) {
          getPopup().hidden = true;
        }
      }

      function syncAnchorAlignments(sel) {
        const selectedOption = sel.selectedOptions[0].value;
        allPopups.forEach(p => {
          p.anchorAlign = selectedOption;
        });
      }

      function syncPointerAlignments(sel) {
        const selectedOption = sel.selectedOptions[0].value;
        allPopups.forEach(p => {
          p.pointerAlign = selectedOption;
        });
      }

      function syncPointerType(sel) {
        pointerType = sel.selectedOptions[0].value;
      }

      function syncPrefs(sel) {
        const selectedOption = sel.selectedOptions[0].value;
        allPopups.forEach(p => {
          p.orientation = selectedOption;
        });
      }

      function toggleOverlay(chkbox) {
        const body = document.documentElement;
        const overlayAttr = '_show-overlay';

        if (chkbox.checked) {
          body.setAttribute(overlayAttr, 'true');
        } else {
          body.removeAttribute(overlayAttr);
        }
      }

      function embiggenPopup(chkbox) {
        if (chkbox.checked) {
          allPopups.forEach(p => {
            p.querySelector('.popup-content').classList.add('embiggen');
          });
        } else {
          allPopups.forEach(p => {
            p.querySelector('.popup-content').classList.remove('embiggen');
          });
        }
      }

      let closeOnBackdropClick = false;

      function allowBackdropClick(chkbox) {
        closeOnBackdropClick = chkbox.checked;
      }

      window.onload = async function () {
        if (
          navigator.userAgent.indexOf('Firefox') &&
          document.querySelector('body').getBoundingClientRect().width === 0
        ) {
          /*
           *
           * when the dev-server first launches, Firefox (if the default browser) has a tendency to die
           * while trying to load the module (index.js). This forces a reload and, voila, Firefox
           * works fine again.
           *
           */
          location.reload();
        } else {
          document.getElementById('popupForm')?.reset();
        }
      };
    </script>
  </body>
</html>
